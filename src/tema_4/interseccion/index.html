<!DOCTYPE html>
<html>

<head>
  <title>INTERSECTION LIST</title>
</head>

<body>
  <ul id="lista1">
    <li>manzana</li>
    <li>pera</li>
    <ul>
      <li>conferencia</li>
      <ul>
        <li>conferenciaverde</li>
        <li>conferenciaamarilla</li>
        <li>conferenciaroja</li>
      </ul>
      <li>peradeagua</li>
      <li>peritadulce</li>
      <ul>
        <li>Dimas</li>
        <li>Gestas</li>
        <li>Malakatos</li>
        <li>Jose</li>
        <li>Jose</li>
      </ul>
    </ul>
    <li>limon</li>
    <li>limon</li>
    <li>LIMON</li>
  </ul>

  <ul id="lista2">
    <li>manzana</li>
    <li>manzana</li>
    <li>manzana</li>
    <li>manzana</li>
    <li>pera</li>
    <li>limon</li>
    <li>jose</li>
    <li>jose</li>
  </ul>

  <script>
    /* 
    Realiza un programa que muestre por consola la INTERSECCIÓN de las dos listas SIN DUPLICADOS de forma
    ordenada. 
    Lista1 y Lista2 son los identificadores en el DOM de ambas listas.
    No puedes recuperar objetos del DOM por tag.
    No puedes utilizar el método filter() ni la palabra clave IN.
    */

    let lista1 = document.getElementById("lista1");
    let lista2 = document.getElementById("lista2");

    function extraccion(lista) {
      let arr = [];
      for (let i = 0; i < lista.children.length; i++) {
        if (lista.children[i].children.length > 0) {
          arr = arr.concat(extraccion(lista.children[i]));
        } else {
          arr.push(lista.children[i].innerHTML);
        }
      }
      return arr;
    }

    let arrLista1 = extraccion(lista1);
    let arrLista2 = extraccion(lista2);

    function interseccion(arr1, arr2) {
      let aux = [];

      arr1.map((e) => {
        if (arr2.find((i) => {if (i.toUpperCase() === e.toUpperCase()) return true;}) 
        && !aux.find((i) => {if (i.toUpperCase() === e.toUpperCase()) return true;})) aux.push(e.toUpperCase());
      });

      return aux.sort();
    }

    console.log(interseccion(arrLista1, arrLista2));
  </script>
</body>

</html>